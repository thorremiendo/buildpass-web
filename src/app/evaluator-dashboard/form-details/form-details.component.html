<ng-container>
  <h2>{{ getDocType(data.form.document_id) }}</h2>
  <div class="mt-3" *ngIf="!user.employee_detail">
    <div
      *ngIf="
        data.form.document_status_id == 2 || data.form.document_status_id == 0
      "
    >
      <p style="font-size: 14px; color: maroon">
        <strong
          >Note: This is a non-compliant document, please review the evaluator
          remarks below.</strong
        >
      </p>
      <ng-container *ngIf="isDocumentAForm(); else noteForFile">
        <p style="font-size: 14px" class="m-0 p-0">
          <strong
            >1. Please click the "Save" to save your changes on the
            form.</strong
          >
        </p>
        <p style="font-size: 14px" class="m-0 p-0">
          <strong
            >2. Lastly, click the "Update" button at the bottom of the page to
            proceed.</strong
          >
        </p>
      </ng-container>
      <ng-template #noteForFile>
        <p style="font-size: 14px" class="m-0 p-0">
          <strong>Please upload your new file and click on "Update".</strong>
        </p>
      </ng-template>
    </div>
  </div>
  <ng-container *ngIf="user.employee_detail">
    <div class="d-flex justify-content-md-between">
      <button mat-button (click)="resetWatermark()" color="primary">
        Remove Watermark
      </button>
      <div class="rotation-buttons">
        <button mat-button (click)="rotateLeft()">
          <mat-icon>rotate_left</mat-icon>
        </button>
        <button mat-button (click)="resetRotate()">
          <mat-icon>crop_portrait</mat-icon>
        </button>
        <button mat-button (click)="rotateRight()">
          <mat-icon>rotate_right</mat-icon>
        </button>
      </div>
      <button
        mat-button
        (click)="removeAnnotations('evaluator')"
        color="primary"
      >
        Clear Annotations
      </button>
    </div>

    <ng-container
      *ngIf="
        this.data.form.document_id !== 49 &&
          this.data.form.document_id !== 44 &&
          this.data.form.document_id !== 43 &&
          this.data.form.document_id !== 45 &&
          this.data.form.document_id !== 50;
        else officeForms
      "
    >
      <div class="pdf-container">
        <div class="container">
          <div id="pdf-div" class="pdf-view"></div>
        </div>
      </div>
    </ng-container>
    <ng-template #officeForms>
      <ngx-extended-pdf-viewer
        [src]="data.form.document_path"
        [showToolbar]="true"
        [showSidebarButton]="false"
        [showFindButton]="false"
        [showPagingButtons]="false"
        [showZoomButtons]="true"
        [showPresentationModeButton]="true"
        [showOpenFileButton]="false"
        [showPrintButton]="false"
        [showDownloadButton]="true"
        [showBookmarkButton]="false"
        [showSecondaryToolbarButton]="true"
        [showRotateButton]="false"
        [showHandToolButton]="false"
        [showScrollingButton]="false"
        [showSpreadButton]="false"
        [showPropertiesButton]="false"
        [useBrowserLocale]="true"
        height="1000px"
        zoom="100%"
      >
      </ngx-extended-pdf-viewer>
    </ng-template>
  </ng-container>
  <ng-container *ngIf="!user.employee_detail">
    <ng-container *ngIf="isDocumentAForm(); else notAForm">
      <div class="text-right m-3">
        <button
          mat-button
          (click)="removeAnnotations('applicant')"
          color="primary"
        >
          Clear Annotations
        </button>
      </div>
      <div class="pdf-container">
        <div class="container">
          <div id="pdf-div" class="pdf-view"></div>
        </div>
      </div>
    </ng-container>
    <ng-template #notAForm>
      <ngx-extended-pdf-viewer
        [src]="data.form.document_path"
        [showToolbar]="true"
        [showSidebarButton]="false"
        [showFindButton]="false"
        [showPagingButtons]="false"
        [showZoomButtons]="true"
        [showPresentationModeButton]="true"
        [showOpenFileButton]="false"
        [showPrintButton]="false"
        [showDownloadButton]="true"
        [showBookmarkButton]="false"
        [showSecondaryToolbarButton]="true"
        [showRotateButton]="false"
        [showHandToolButton]="false"
        [showScrollingButton]="false"
        [showSpreadButton]="false"
        [showPropertiesButton]="false"
        [useBrowserLocale]="true"
        height="1000px"
        zoom="100%"
      >
      </ngx-extended-pdf-viewer>
    </ng-template>
  </ng-container>

  <div [formGroup]="permitDetails" *ngIf="user.employee_detail">
    <div
      class="row"
      *ngIf="
        this.data.form.document_id !== 49 &&
        this.data.form.document_id !== 44 &&
        this.data.form.document_id !== 43 &&
        this.data.form.document_id !== 45 &&
        this.data.form.document_id !== 50
      "
    >
      <div class="col-md-12 mt-5">
        <mat-form-field appearance="fill">
          <mat-label>Review</mat-label>
          <mat-select formControlName="is_compliant">
            <mat-option value="1"> Compliant </mat-option>
            <mat-option value="2"> Non-Compliant </mat-option>
          </mat-select>
        </mat-form-field>
        <ng-container
          *ngIf="
            revisionData !== undefined &&
            permitDetails.value.is_compliant == '2'
          "
        >
          <div *ngIf="!isLoading">
            <table
              mat-table
              [dataSource]="revisionData"
              class="full-width"
              #itemsTable
            >
              <ng-container matColumnDef="index">
                <th mat-header-cell *matHeaderCellDef>No.</th>
                <td mat-cell *matCellDef="let item; let i = index">
                  {{ i + 1 }}
                </td>
              </ng-container>

              <ng-container matColumnDef="remark">
                <th mat-header-cell *matHeaderCellDef>Remark</th>
                <td mat-cell *matCellDef="let item">
                  {{ item.remarks == "" ? "Compliant" : item.remarks }}
                </td>
              </ng-container>
              <ng-container matColumnDef="date">
                <th mat-header-cell *matHeaderCellDef>Date</th>
                <td mat-cell *matCellDef="let item">
                  {{
                    item.created_at | date: "MMMM dd, yyyy hh:mm:ss a":"+0800"
                  }}
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr
                mat-row
                *matRowDef="let items; columns: displayedColumns"
              ></tr>
            </table>

            <form
              *ngIf="revisionData.length >= 1 && data.evaluator"
              [formGroup]="remarksForm"
            >
              <div class="row mt-5 mx-2">
                <div>
                  <mat-form-field style="width: 800px">
                    <mat-label>Add a Remark</mat-label>
                    <input matInput formControlName="remarks" />
                  </mat-form-field>
                </div>
                <div class="ml-5">
                  <button
                    mat-raised-button
                    color="warn"
                    type="button"
                    [disabled]="!remarksForm.value.remarks || isSubmitting"
                    (click)="addRemarks()"
                  >
                    Add
                  </button>
                </div>
              </div>
            </form>
          </div>
        </ng-container>
      </div>
    </div>
    <div class="d-flex justify-content-between align-items-center my-5">
      <div class="text-left">
        <button
          mat-raised-button
          color="accent"
          (click)="onNoClick()"
          [disabled]="isSubmitting"
        >
          Close
        </button>
      </div>
      <div
        class="text-right"
        *ngIf="
          this.data.form.document_id !== 49 &&
          this.data.form.document_id !== 44 &&
          this.data.form.document_id !== 43 &&
          this.data.form.document_id !== 45 &&
          this.data.form.document_id !== 50
        "
      >
        <ng-container *ngIf="permitDetails.value.is_compliant == '1'">
          <button
            mat-raised-button
            color="primary"
            (click)="callSave()"
            [disabled]="isSubmitting"
          >
            Save
          </button>
        </ng-container>
        <ng-container *ngIf="permitDetails.value.is_compliant == '2'">
          <button
            mat-raised-button
            color="primary"
            (click)="callSave()"
            [disabled]="isSubmitting"
          >
            Save
          </button>
        </ng-container>
      </div>
    </div>
  </div>
  <div class="mt-3" *ngIf="!user.employee_detail">
    <div
      *ngIf="
        data.form.document_status_id == 2 || data.form.document_status_id == 0
      "
    >
      <mat-expansion-panel
        (opened)="panelOpenState = true"
        (closed)="panelOpenState = false"
      >
        <mat-expansion-panel-header>
          <mat-panel-title
            ><mat-icon aria-hidden="false" class="mr-2" style="color: maroon"
              >announcement</mat-icon
            >Remarks</mat-panel-title
          >
        </mat-expansion-panel-header>
        <app-remarks-history-table></app-remarks-history-table>
      </mat-expansion-panel>
      <ng-container *ngIf="isDocumentAForm(); else uploadFiles"> </ng-container>
      <ng-template #uploadFiles>
        <ngx-dropzone
          (change)="onSelect($event, 'selectedForm')"
          [multiple]="false"
          class="mt-3"
          accept="application/pdf"
        >
          <ngx-dropzone-label
            >Click here to upload new file!
          </ngx-dropzone-label>
          <ngx-dropzone-preview
            *ngIf="selectedForm"
            [removable]="true"
            (removed)="onRemove('selectedForm')"
            class="mx-auto"
          >
            <ngx-dropzone-label
              >{{ selectedForm.name }} ({{
                selectedForm.type
              }})</ngx-dropzone-label
            >
          </ngx-dropzone-preview>
        </ngx-dropzone>
      </ng-template>
    </div>
  </div>
  <div *ngIf="!user.employee_detail">
    <div class="d-flex justify-content-between align-items-center mt-5">
      <button
        mat-raised-button
        color="accent"
        (click)="onNoClick()"
        [disabled]="isSubmitting"
      >
        Close
      </button>
      <ng-container *ngIf="isDocumentAForm(); else fileButton">
        <button
          *ngIf="
            data.form.document_status_id == 2 ||
            data.form.document_status_id == 0
          "
          mat-raised-button
          color="primary"
          [disabled]="isSubmitting"
          (click)="updateForm()"
        >
          Update
        </button>
      </ng-container>
      <ng-template #fileButton>
        <button
          *ngIf="
            data.form.document_status_id == 2 ||
            data.form.document_status_id == 0
          "
          mat-raised-button
          color="primary"
          [disabled]="isSubmitting || !selectedForm"
          (click)="callUpdate()"
        >
          Update
        </button>
      </ng-template>
    </div>
  </div>
</ng-container>

<ng-container *ngIf="isSubmitting">
  <div>
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
  </div>
</ng-container>
