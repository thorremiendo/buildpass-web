<div class="app-details" *ngIf="applicationDetails && isAuthorized">
  <mat-card>
    <mat-card-content>
      <div class="d-flex justify-content-between">
        <div>
          <h4 style="color: #313131" class="mb-4">
            <strong>Application Details</strong>
          </h4>
        </div>
      </div>
      <div class="row mb-1">
        <div class="avatar-container col-md-4 text-center">
          <div>
            <h5>
              <strong
                >&nbsp;{{
                  applicationDetails.applicant_detail.first_name
                }}&nbsp;{{
                  applicationDetails.applicant_detail.last_name
                }}</strong
              >
            </h5>
          </div>
          <div>
            <h5 style="color: #7b7b7b">
              {{ applicationDetails.applicant_detail.email_address }}
            </h5>
          </div>
          <div>
            <h5 style="color: #7b7b7b">
              {{ applicationDetails.applicant_detail.contact_number }}
            </h5>
          </div>
          <div>
            <h5 style="color: #7b7b7b">
              {{ applicationDetails.applicant_detail.barangay }}
            </h5>
          </div>
        </div>
        <div class="col-md-4">
          <div class="col">
            <h5 style="color: #7b7b7b">Application Number:</h5>
            <h5>
              <strong>{{ applicationDetails.ocpas_code }}</strong>
            </h5>
          </div>
          <div class="col">
            <h5 style="color: #7b7b7b">Application Date:</h5>
            <h5>
              <strong
                >&nbsp;{{
                  applicationDetails.created_at | date: "MMMM dd, yyyy"
                }}</strong
              >
            </h5>
          </div>
        </div>
        <div class="col-md-4">
          <div class="col">
            <h5 style="color: #7b7b7b">Application Status:</h5>
            <h5>
              <strong
                >&nbsp;
                {{
                  getApplicationStatus(applicationDetails.application_status_id)
                }}
              </strong>
            </h5>
          </div>
          <div class="col">
            <h5 style="color: #7b7b7b">Application Type:</h5>
            <h5>
              <strong
                >&nbsp;{{
                  getApplicationType(applicationDetails.permit_type_id)
                }}</strong
              >
            </h5>
          </div>
        </div>
      </div>
      <div class="mt-5">
        <ng-container
          *ngIf="
            applicationDetails.permit_type_id !== 1 &&
            applicationDetails.main_permit_id
          "
        >
          <a
            [routerLink]="['../', applicationDetails.main_permit_id]"
            routerLinkActive="active"
            target="_blank"
          >
            <button mat-raised-button class="ml-2" color="primary">
              View My Building Permit
            </button></a
          ></ng-container
        >

        <button
          mat-raised-button
          color="primary"
          (click)="openProjectDialog()"
          class="ml-2"
          *ngIf="applicationDetails.permit_type_id == 1"
        >
          Project Details
        </button>

        <button
          class="ml-2"
          mat-raised-button
          color="primary"
          (click)="openRepresentativeDialog()"
          *ngIf="applicationDetails.is_representative == 1"
        >
          Engineer/Architect In-charge Details
        </button>
        <button
          mat-raised-button
          class="ml-2"
          color="accent"
          (click)="openFeesDialog()"
        >
          View Fees
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <div class="app-timeline">
    <mat-card>
      <mat-card-content>
        <h4 style="color: #313131" class="mb-4">
          <strong>Application Timeline</strong>
          <hr />
        </h4>
        <div>
          <mat-expansion-panel
            (opened)="panelOpenState = true"
            (closed)="panelOpenState = false"
            class="mb-2"
          >
            <mat-expansion-panel-header>
              <mat-panel-title
                ><mat-icon
                  aria-hidden="false"
                  class="mr-2"
                  style="color: maroon"
                  >timeline</mat-icon
                >
                View Timeline</mat-panel-title
              >
            </mat-expansion-panel-header>
            <div class="row">
              <div class="col-md-6">
                <app-application-timeline></app-application-timeline>
              </div>
              <div class="col-md-6">
                <div class="notif-card">
                  <div class="col">
                    <p>Reminder:</p>
                    <!-- <span>Lorem ipsum ipsum thor pogi</span> -->
                  </div>
                </div>
              </div>
            </div>
          </mat-expansion-panel>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
  <div class="app-forms" *ngIf="!isLoading">
    <mat-card>
      <mat-card-content>
        <mat-tab-group>
          <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon>assignment</mat-icon>
              Applicant Forms
            </ng-template>
            <div>
              <div>
                <table mat-table [dataSource]="dataSource">
                  <!--- Note that these columns can be defined in any order.
                              The actual rendered columns are set as a property on the row definition" -->
                  <ng-container matColumnDef="index">
                    <th mat-header-cell *matHeaderCellDef>No.</th>
                    <td mat-cell *matCellDef="let element; let i = index">
                      {{ i + 1 }}
                    </td>
                  </ng-container>
                  <!--  Name Column -->
                  <ng-container matColumnDef="name">
                    <th mat-header-cell *matHeaderCellDef>
                      Documentary Requirements
                    </th>
                    <td mat-cell *matCellDef="let element">
                      {{ getDocType(element.document_id) }}
                    </td>
                  </ng-container>

                  <!-- Status Column -->
                  <ng-container matColumnDef="status">
                    <th mat-header-cell *matHeaderCellDef>Status</th>
                    <td
                      mat-cell
                      *matCellDef="let element"
                      [style.color]="
                        element.document_status_id == 1
                          ? 'green'
                          : element.document_status_id == 0
                          ? 'black'
                          : 'red'
                      "
                    >
                      {{ getDocStatus(element.document_status_id) }}
                    </td>
                  </ng-container>
                  <!-- Remarks Column -->
                  <ng-container matColumnDef="remarks">
                    <th mat-header-cell *matHeaderCellDef>Remarks</th>
                    <td mat-cell *matCellDef="let element">
                      <!-- <a (click)="openRemarksHistory(element)" style="color: orange">
                      View
                    </a> -->
                      <mat-icon
                        class="remark"
                        (click)="openRemarksHistory(element)"
                        [matBadge]="element.document_revision.length"
                        matBadgeColor="warn"
                        >remove_red_eye</mat-icon
                      >
                    </td>
                  </ng-container>

                  <!-- Action Column -->
                  <ng-container matColumnDef="action">
                    <th mat-header-cell *matHeaderCellDef>Action</th>
                    <td mat-cell *matCellDef="let element">
                      <ng-container
                        *ngIf="applicationDetails.application_status_id !== 11"
                      >
                        <button
                          [disabled]="
                            element.document_status_id !== 2 ||
                            applicationDetails.application_status_id !== 5
                          "
                          mat-button
                          color="accent"
                          (click)="openFormDialog(element)"
                        >
                          <mat-icon class="action">mode_edit</mat-icon>
                        </button>
                      </ng-container>
                      <ng-container
                        *ngIf="applicationDetails.application_status_id == 11"
                      >
                        <a href="{{ element.document_path }}" target="_blank"
                          >Print</a
                        >
                      </ng-container>
                    </td>
                  </ng-container>
                  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                  <tr
                    mat-row
                    *matRowDef="let row; columns: displayedColumns"
                  ></tr>
                </table>
                <div class="text-right mt-5">
                  <ng-container
                    *ngIf="this.applicationDetails.permit_type_id == 1"
                  >
                    <button
                      mat-raised-button
                      color="warn"
                      (click)="onSave()"
                      [disabled]="
                        applicationDetails.application_status_id !== 5
                      "
                    >
                      Save
                    </button></ng-container
                  >
                  <ng-container
                    *ngIf="
                      this.applicationDetails.permit_type_id !== 1 &&
                      this.applicationDetails.permit_type_id !== 2
                    "
                  >
                    <button
                      mat-raised-button
                      color="warn"
                      (click)="otherPermitsSave()"
                      [disabled]="
                        applicationDetails.application_status_id !== 5
                      "
                    >
                      Save
                    </button>
                  </ng-container>
                </div>
              </div>
            </div>
          </mat-tab>
          <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon>folder</mat-icon>
              Supporting Documents
            </ng-template>
            <app-supporting-documents
              [evaluatorDetails]="evaluatorDetails"
              [applicationDetails]="applicationDetails"
            ></app-supporting-documents>
          </mat-tab>
        </mat-tab-group>
      </mat-card-content>
    </mat-card>
  </div>
  <div class="spinner" *ngIf="isLoading">
    <mat-spinner></mat-spinner>
  </div>
</div>

<ng-container *ngIf="!isAuthorized">
  <div
    class="d-flex justify-content-center align-items-center w-100 flex-column mt-5"
  >
    <img src="../../../assets/illustrations/stop.svg" style="width: 100px" />
    <h3 class="mt-5" style="font-weight: bold; color: maroon">
      You are not allowed to view this page.
    </h3>
    <p style="font-weight: bold">
      Click <a routerLink="../../">here</a> to go back.
    </p>
  </div>
</ng-container>
