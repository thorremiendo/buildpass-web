<ng-container *ngIf="applicationDetails">
  <div class="app-details" *ngIf="!isLoading">
    <mat-card>
      <mat-card-content>
        <div class="d-flex justify-content-between">
          <div>
            <h4 style="color: #ffa653" class="mb-4">
              <strong>Application Details</strong>
            </h4>
          </div>
        </div>
        <div class="row mb-1">
          <div class="avatar-container col-md-4 text-center">
            <div>
              <h5>
                <strong
                  >&nbsp;{{
                    applicationDetails.applicant_detail.first_name
                  }}&nbsp;{{
                    applicationDetails.applicant_detail.last_name
                  }}</strong
                >
              </h5>
            </div>
            <div>
              <h5 style="color: #7b7b7b">
                {{ applicationDetails.applicant_detail.email_address }}
              </h5>
            </div>
            <div>
              <h5 style="color: #7b7b7b">
                {{ applicationDetails.applicant_detail.contact_number }}
              </h5>
            </div>
            <div>
              <h5 style="color: #7b7b7b">
                {{ applicationDetails.applicant_detail.barangay }}
              </h5>
            </div>
          </div>
          <div class="col-md-4">
            <div class="col">
              <h5 style="color: #7b7b7b">Application Number:</h5>
              <h5>
                <strong>{{
                  applicationDetails.permit_application_code
                }}</strong>
              </h5>
            </div>
            <div class="col">
              <h5 style="color: #7b7b7b">Date Submitted:</h5>
              <h5>
                <strong
                  >&nbsp;{{
                    applicationDetails.created_at | date: "MMMM dd, yyyy"
                  }}</strong
                >
              </h5>
            </div>
          </div>
          <div class="col-md-4">
            <div class="col">
              <h5 style="color: #7b7b7b">Application Status:</h5>
              <h5
                [style.color]="
                  applicationDetails.application_status_id == 11
                    ? 'green'
                    : 'red'
                "
              >
                <strong
                  >&nbsp;
                  {{
                    getApplicationStatus(
                      applicationDetails.application_status_id
                    )
                  }}
                </strong>
              </h5>
            </div>
            <div class="col">
              <h5 style="color: #7b7b7b">Application Type:</h5>
              <h5>
                <strong
                  >&nbsp;
                  {{ getApplicationType(applicationDetails.permit_type_id) }}
                </strong>
              </h5>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
  <div class="app-timeline" *ngIf="!isLoading">
    <mat-card>
      <mat-card-content>
        <h4 style="color: maroon" class="mb-4">
          <strong>Application Timeline</strong>
          <hr />
        </h4>

        <div>
          <mat-expansion-panel
            (opened)="panelOpenState = true"
            (closed)="panelOpenState = false"
            class="mb-2"
          >
            <mat-expansion-panel-header>
              <mat-panel-title
                ><mat-icon
                  aria-hidden="false"
                  class="mr-2"
                  style="color: maroon"
                  >timeline</mat-icon
                >
                View Timeline</mat-panel-title
              >
            </mat-expansion-panel-header>
            <app-application-timeline
              [type]="applicationDetails.permit_type_id"
            ></app-application-timeline>
          </mat-expansion-panel>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
  <div class="app-fees" *ngIf="!isLoading">
    <mat-card>
      <mat-card-content>
        <h4 style="color: #12632a" class="mb-4">
          <strong>Application Fees</strong>
          <hr />
        </h4>
        <div>
          <mat-expansion-panel
            (opened)="panelOpenState = true"
            (closed)="panelOpenState = false"
            class="mb-2"
          >
            <mat-expansion-panel-header>
              <mat-panel-title
                ><mat-icon
                  aria-hidden="false"
                  class="mr-2"
                  style="color: maroon"
                  >file_copy</mat-icon
                >
                Application Fees Summary</mat-panel-title
              >
            </mat-expansion-panel-header>
            <app-application-fees-summary></app-application-fees-summary>
          </mat-expansion-panel>
          <mat-expansion-panel
            (opened)="panelOpenState = true"
            (closed)="panelOpenState = false"
            class="mb-2"
          >
            <mat-expansion-panel-header>
              <mat-panel-title
                ><mat-icon
                  aria-hidden="false"
                  class="mr-2"
                  style="color: maroon"
                  >build</mat-icon
                >
                City Buildings and Architecture Office</mat-panel-title
              >
            </mat-expansion-panel-header>
            <div *ngIf="cbaoFees">
              <table
                mat-table
                [dataSource]="cbaoFees"
                class="full-width"
                #itemsTable
              >
                <ng-container matColumnDef="number">
                  <th mat-header-cell *matHeaderCellDef>No.</th>
                  <td mat-cell *matCellDef="let item; let i = index">
                    {{ item.name ? i + 1 : "Total" }}
                  </td>
                </ng-container>

                <ng-container matColumnDef="description">
                  <th mat-header-cell *matHeaderCellDef>Description</th>
                  <td mat-cell *matCellDef="let item">
                    {{ item.name ? item.name : "----------------------" }}
                  </td>
                </ng-container>

                <ng-container matColumnDef="evaluator">
                  <th mat-header-cell *matHeaderCellDef>Assessed By</th>
                  <td mat-cell *matCellDef="let item">
                    {{
                      item.evaluator_detail
                        ? item.evaluator_detail.first_name
                        : ""
                    }}
                    {{
                      item.evaluator_detail
                        ? item.evaluator_detail.last_name
                        : ""
                    }}
                  </td>
                </ng-container>

                <ng-container matColumnDef="amount">
                  <th mat-header-cell *matHeaderCellDef>Amount</th>
                  <td mat-cell *matCellDef="let item">
                    {{
                      item.amount
                        ? (item.amount | currency: "PHP")
                        : (item.office | currency: "PHP")
                    }}
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
                <tr
                  mat-row
                  *matRowDef="let items; columns: columnsToDisplay"
                ></tr>
              </table>
            </div>
          </mat-expansion-panel>
          <mat-expansion-panel
            (opened)="panelOpenState = true"
            (closed)="panelOpenState = false"
            class="mb-2"
            *ngIf="applicationDetails.permit_type_id == 1"
          >
            <mat-expansion-panel-header>
              <mat-panel-title
                ><mat-icon
                  aria-hidden="false"
                  class="mr-2"
                  style="color: maroon"
                  >create</mat-icon
                >
                City Planning and Development Office</mat-panel-title
              >
            </mat-expansion-panel-header>
            <app-cpdo-fees-table></app-cpdo-fees-table>
          </mat-expansion-panel>
          <mat-expansion-panel
            (opened)="panelOpenState = true"
            (closed)="panelOpenState = false"
            class="mb-2"
            *ngIf="
              applicationDetails.permit_type_id == 1 ||
              applicationDetails.permit_type_id == 2
            "
          >
            <mat-expansion-panel-header>
              <mat-panel-title
                ><mat-icon
                  aria-hidden="false"
                  class="mr-2"
                  style="color: maroon"
                  >local_fire_department</mat-icon
                >
                Bureau of Fire Protection</mat-panel-title
              >
            </mat-expansion-panel-header>
            <app-bfp-fees-table></app-bfp-fees-table>
          </mat-expansion-panel>
          <mat-expansion-panel
            (opened)="panelOpenState = true"
            (closed)="panelOpenState = false"
            *ngIf="
              applicationDetails.permit_type_id == 1 ||
              applicationDetails.permit_type_id == 2
            "
          >
            <mat-expansion-panel-header>
              <mat-panel-title
                ><mat-icon
                  aria-hidden="false"
                  class="mr-2"
                  style="color: maroon"
                  >grass</mat-icon
                >
                City Environment and Parks Management Office</mat-panel-title
              >
            </mat-expansion-panel-header>
            <app-cepmo-fees-table></app-cepmo-fees-table>
          </mat-expansion-panel>
        </div>
        <div class="mt-5 text-right">
          <button
            mat-raised-button
            color="primary"
            (click)="openPaymentDialog()"
          >
            Mark as Paid
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
  <div class="pdf" *ngIf="unifiedBpForm && unifiedBpFees">
    <mat-card>
      <mat-card-content>
        <app-pdf-form-save
          [form]="unifiedBpForm"
          [applicationDetails]="applicationDetails"
          [fees]="unifiedBpFees"
        ></app-pdf-form-save>
      </mat-card-content>
    </mat-card>
  </div>
</ng-container>

<div class="spinner" *ngIf="isLoading">
  <mat-spinner></mat-spinner>
</div>
